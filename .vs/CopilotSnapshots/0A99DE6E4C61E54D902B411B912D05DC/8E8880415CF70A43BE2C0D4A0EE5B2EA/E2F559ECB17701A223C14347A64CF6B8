using System;
using System.Data.SqlClient;
using System.Web.UI;

namespace WebApplication1
{
    public partial class Default : System.Web.UI.Page
    {
        // Connection string for database access
        string connStr = System.Configuration.ConfigurationManager.ConnectionStrings["OnlineOrderSystemConnection"].ConnectionString;

        // Page load event
        protected void Page_Load(object sender, EventArgs e)
        {
            // On first load, load dashboard data
            if (!IsPostBack)
            {
                LoadDashboardData();
            }
        }

        // Loads dashboard statistics: total staff, products in stock, and monthly sales
        private void LoadDashboardData()
        {
            int totalStaff = 0;
            int productsInStock = 0;
            decimal monthlySales = 0;
            using (var conn = new SqlConnection(connStr))
            {
                conn.Open();
                // Get total number of staff
                using (var cmd = new SqlCommand("SELECT COUNT(*) FROM Staff", conn))
                {
                    totalStaff = (int)cmd.ExecuteScalar();
                }
                // Get total products in stock
                using (var cmd = new SqlCommand("SELECT SUM(StockQuantity) FROM Item", conn))
                {
                    var result = cmd.ExecuteScalar();
                    productsInStock = result != DBNull.Value ? Convert.ToInt32(result) : 0;
                }
                // Get total sales for the current month
                using (var cmd = new SqlCommand("SELECT SUM(PaymentAmount) FROM Payment WHERE MONTH(PaymentDate) = MONTH(GETDATE()) AND YEAR(PaymentDate) = YEAR(GETDATE())", conn))
                {
                    var result = cmd.ExecuteScalar();
                    monthlySales = result != DBNull.Value ? Convert.ToDecimal(result) : 0;
                }
            }
            // Display results on dashboard
            lblTotalStaff.Text = totalStaff.ToString();
            lblProductsInStock.Text = productsInStock.ToString();
            lblMonthlySales.Text = monthlySales.ToString("F2");
        }
    }
}